<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<dom-module id="page-markets">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment app-grid-style"></style>
    <style include="shared-styles">
     :host {
      display: block;
    }

    vaadin-grid {
      height: 100%;
    }

    paper-card {
      padding: 16px
    }

 
    </style>
    <looper-page>
      <looper-toolbar slot="secondary-toolbar" active-tab="markets">
      </looper-toolbar>
      <div class="sections">
        <paper-card>

          <iron-ajax
            auto
            url="https://raw.githubusercontent.com/Loopring/mock-relay-data/master/tickers.json"
            handle-as="json"
            last-response="{{data}}"
            debounce-duration="300">
          </iron-ajax>

          <vaadin-grid aria-label="Markets" items="[[data.result]]"><!-- items="[[_show(data.result, size)]]" -->
            <vaadin-grid-column>
              <template class="header">MARKET</template>
              <template><a href="#/market/[[_a(item.market)]]">[[item.market]]</a></template>
            </vaadin-grid-column>
            <vaadin-grid-column>
              <template class="header">LAST PRICE</template>
              <template>[[item.last]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column width="60px">
              <template class="header">CHANGE</template>
              <template>
                <div class="horizontal layout">
                  <div><iron-icon icon="{{_icon(item.change)}}"></iron-icon></div>
                  <div>[[_showChange(item.change)]]</div>
                </div>
              </template>
            </vaadin-grid-column>
            <vaadin-grid-column width="50px">
              <template class="header">24HR VOLUME</template>
              <template>[[item.vol]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column width="50px">
              <template class="header">BID</template>
              <template>[[item.buy]]</template>
            </vaadin-grid-column>
            <vaadin-grid-column width="50px">
              <template class="header">ASK</template>
              <template>[[item.sell]]</template>
            </vaadin-grid-column>
          </vaadin-grid>
        </paper-card>

        <!--
        <div style="margin-top: 10px; margin-bottom: 10px;">
          <a href="#" on-click="_showAll">View full list</a>
        </div>
        -->
        <div class="footer-spacer flex"></div>
        <looper-footer></looper-footer>
      </div>
    </looper-page>
  </template>
  <script>
  class PageMarkets extends Polymer.Element {
    static get is() { return 'page-markets'; }

    ready() {
      super.ready();
      this.size = 10;
    }

    _a(value){
      if(!value){
        return "#";
      }
      return value.split("/")[0].toLowerCase()
    }

    _show(data, size){
      if(!data){
        return;
      }
      return data.slice(0, size)
    }

    _showAll(){
      if(!this.data){
        return;
      }
      this.size = this.data.result.size
    }

    _icon(value){
      if(value >0) return "icons:arrow-upward"
      else return "icons:arrow-downward"
    }

    _showChange(value){
      return value+"%"
    }
  }

  window.customElements.define(PageMarkets.is, PageMarkets);
  </script>
</dom-module>